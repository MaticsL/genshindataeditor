<template>
  <div>
    <input @change="upload($event)" type="file" id="fileLoad" /><el-divider></el-divider>
    <el-row>
      <el-col :span="3"><el-button @click="handleAdd">新建掉落</el-button></el-col>
      <el-col :span="3"><el-button @click="download">下载文件</el-button></el-col>
    </el-row>
    <el-table
    :data="dropJson"
    style="width: 100%">
    <el-table-column
      label="怪物ID"
      width="180">
      <template slot-scope="scope">
        <span style="margin-left: 10px">{{ scope.row.monsterId }}</span>
      </template>
    </el-table-column>
    <el-table-column
      label="怪物名"
      width="180">
      <template slot-scope="scope">
        <el-popover trigger="hover" placement="top">
          <p>ID: {{ scope.row.monsterId }}</p>
          <p>怪物名: {{ $data.monid2name[scope.row.monsterId] }}</p>
          <div slot="reference" class="name-wrapper">
            <el-tag size="medium">{{ $data.monid2name[scope.row.monsterId] }}</el-tag>
          </div>
        </el-popover>
      </template>
    </el-table-column>
    <el-table-column label="操作">
      <template slot-scope="scope">
        <el-button
          size="mini"
          @click="handleEdit(scope.$index, scope.row)">编辑</el-button>
        <el-button
          size="mini"
          type="danger"
          @click="handleDelete(scope.$index, scope.row)">删除</el-button>
      </template>
    </el-table-column>
  </el-table>
  <el-dialog title="怪物掉落" :visible.sync="dialogTableVisible" class="monDialog">
    <el-row>
      <el-col :span="3"><el-button @click="handleItemAdd">新建物品</el-button></el-col>
    </el-row>
    <el-table :data="currentMonInfo.dropDataList">
      <el-table-column property="itemId" label="物品ID" width="50"></el-table-column>
      <el-table-column
        label="物品名"
        width="150">
        <template slot-scope="scope">
          <el-popover trigger="hover" placement="top">
            <p>ID: {{ scope.row.itemId }}</p>
            <p>物品名: {{ $data.itemid2name[scope.row.itemId] }}</p>
            <div slot="reference" class="name-wrapper">
              <el-tag size="medium">{{ $data.itemid2name[scope.row.itemId] }}</el-tag>
            </div>
          </el-popover>
        </template>
      </el-table-column>
      <el-table-column property="minCount" label="最小数量"></el-table-column>
      <el-table-column property="maxCount" label="最大数量"></el-table-column>
      <el-table-column property="minWeight" label="最小权重"></el-table-column>
      <el-table-column property="maxWeight" label="最大权重"></el-table-column>
      <el-table-column label="操作" width="150">
        <template slot-scope="scope">
          <el-button
            size="mini"
            @click="handleItemEdit(scope.$index, scope.row)">编辑</el-button>
          <el-button
            size="mini"
            type="danger"
            @click="handleItemDelete(scope.$index, scope.row)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
  </el-dialog>
  <el-dialog title="物品" :visible.sync="itemTableVisible" class="monDialog">
    <el-form ref="itemForm" :model="currentItemInfo" label-width="80px">
      <el-form-item label="物品">
        <el-select v-model="currentItemInfo.itemId" filterable placeholder="请选择">
          <el-option
            v-for="item in itemList"
            :key="item.key"
            :label="item.value"
            :value="item.key * 1">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="最小数量">
        <el-slider
          v-model="currentItemInfo.minCount"
          max=65535
          show-input>
        </el-slider>
      </el-form-item>
      <el-form-item label="最大数量">
        <el-slider
          v-model="currentItemInfo.maxCount"
          max=65535
          show-input>
        </el-slider>
      </el-form-item>
      <el-form-item label="最小权值">
        <el-slider
          max=10000
          v-model="currentItemInfo.minWeight"
          show-input>
        </el-slider>
      </el-form-item>
      <el-form-item label="最大权值">
        <el-slider
          max=10000
          v-model="currentItemInfo.maxWeight"
          show-input>
        </el-slider>
      </el-form-item>
    </el-form>
  </el-dialog>
  </div>
</template>

<script>
export default {
  name: 'Drop',
  data () {
    return {
      msg: 'Welcome to Your Vue.js App',
      dialogTableVisible: false,
      itemTableVisible: false,
      dropJson: {},
      itemList: [],
      itemid2name: {},
      monid2name: {
        21010101: '丘丘人',
        21020101: '木盾丘丘暴徒',
        21020201: '火斧丘丘暴徒',
        21020202: '火斧丘丘暴徒',
        21020301: '岩盾丘丘暴徒',
        21020401: '丘丘霜铠王',
        21020501: '丘丘岩盔王',
        21020601: '冰盾丘丘暴徒',
        21020701: '雷斧丘丘暴徒',
        21020703: '雷斧丘丘暴徒',
        21020801: '丘丘雷兜王',
        20010101: '草史莱姆',
        20010201: '大型草史莱姆',
        20010202: '大型草史莱姆',
        20010301: '风史莱姆',
        20010401: '大型风史莱姆',
        20010403: '大型风史莱姆',
        29010101: '裂空的魔龙',
        29010102: '裂空的魔龙',
        29010103: '裂空的魔龙',
        29010104: '裂空的魔龙',
        29020101: '北风的王狼，奔狼的领主',
        29020102: '北风的王狼，奔狼的领主',
        29030103: '「公子」',
        29030106: '「公子」',
        29040101: '若陀龙王',
        29040102: '若陀龙王',
        29040103: '若陀龙王',
        29040104: '若陀龙王',
        29040111: '若陀龙王',
        29050102: '「女士」',
        29050104: '「女士」',
        29060202: '祸津御建鸣神命',
        29060203: '祸津御建鸣神命',
        20020101: '狂风之核',
        20040101: '无相之雷',
        20040102: '无相之雷',
        20040201: '无相之风',
        20040202: '无相之风',
        20040301: '无相之岩',
        20040302: '无相之岩',
        20040401: '无相之水',
        20040501: '无相之冰',
        20040601: '无相之火',
        20010501: '雷史莱姆',
        20010601: '大型雷史莱姆',
        20010604: '大型雷史莱姆',
        20010701: '变异雷史莱姆',
        20010702: '变异雷史莱姆',
        20010801: '冰史莱姆',
        20010802: '冰史莱姆',
        20010901: '大型冰史莱姆',
        20010902: '大型冰史莱姆',
        20010904: '大型冰史莱姆',
        20011001: '水史莱姆',
        20011101: '大型水史莱姆',
        20011103: '大型水史莱姆',
        20011601: '无相之水·召唤物',
        20011701: '无相之水·召唤物',
        20011801: '无相之水·召唤物',
        20011901: '无相之水·召唤物',
        20050101: '纯水精灵',
        20050102: '纯水精灵',
        20050201: '幻形豕兽·水',
        20050202: '幻形豕兽·水',
        20050203: '幻形豕兽·水',
        20050301: '幻形鹤·水',
        20050302: '幻形鹤·水',
        20050401: '幻形蟹·水',
        20050402: '幻形蟹·水',
        20050403: '幻形蟹·水',
        20050501: '幻形雀·水',
        20050502: '幻形雀·水',
        20050601: '幻形游禽·水',
        20050602: '幻形游禽·水',
        20050603: '幻形游禽·水',
        20050701: '幻形花鼠·水',
        20050702: '幻形花鼠·水',
        20050703: '幻形花鼠·水',
        20050801: '幻形蛙·水',
        20050802: '幻形蛙·水',
        20050901: '幻形飞鸢·水',
        20070101: '雷音权现',
        21010201: '打手丘丘人',
        21010301: '木盾丘丘人',
        21010401: '射手丘丘人',
        21010402: '射手丘丘人',
        21010501: '火箭丘丘人',
        21010502: '火箭丘丘人',
        21010601: '爆弹丘丘人',
        21010603: '爆弹丘丘人',
        21010701: '冲锋丘丘人',
        21010901: '冰箭丘丘人',
        21010902: '冰箭丘丘人',
        21011001: '雷箭丘丘人',
        21011002: '雷箭丘丘人',
        21011201: '岩盾丘丘人',
        21011301: '冰弹丘丘人',
        21011302: '冰弹丘丘人',
        21011401: '冰盾丘丘人',
        21011403: '冰盾丘丘人',
        21011501: '奇怪的丘丘人',
        21011601: '雷弹丘丘人',
        21011602: '雷弹丘丘人',
        20011201: '火史莱姆',
        20011202: '火史莱姆',
        20011301: '大型火史莱姆',
        20011304: '大型火史莱姆',
        20011401: '岩史莱姆',
        20011501: '大型岩史莱姆',
        20011502: '大型岩史莱姆',
        22010101: '火深渊法师',
        22010102: '火深渊法师',
        22010103: '火深渊法师',
        22010104: '火深渊法师',
        22010201: '冰深渊法师',
        22010202: '冰深渊法师',
        22010203: '冰深渊法师',
        22010204: '冰深渊法师',
        22010301: '水深渊法师',
        22010302: '水深渊法师',
        22010303: '水深渊法师',
        22010304: '水深渊法师',
        22010401: '雷深渊法师',
        22010403: '雷深渊法师',
        22010404: '雷深渊法师',
        22020101: '深渊使徒·激流',
        22020102: '深渊使徒·激流',
        22030101: '深渊咏者·紫电',
        22030102: '深渊咏者·紫电',
        22030201: '深渊咏者·渊火',
        22030202: '深渊咏者·渊火',
        22040101: '嗜岩·兽境幼兽',
        22040201: '嗜雷·兽境幼兽',
        22050101: '嗜岩·兽境猎犬',
        22050201: '嗜雷·兽境猎犬',
        22060101: '黄金王兽',
        22070101: '黯色空壳·旗令',
        22070102: '黯色空壳·旗令',
        22070201: '黯色空壳·破阵',
        22070202: '黯色空壳·破阵',
        22070301: '黯色空壳·近卫',
        22070302: '黯色空壳·近卫',
        22080101: '黑蛇骑士·斩风之剑',
        21030101: '水丘丘萨满',
        21030103: '水丘丘萨满',
        21030201: '草丘丘萨满',
        21030203: '草丘丘萨满',
        21030301: '风丘丘萨满',
        21030303: '风丘丘萨满',
        21030304: '风丘丘萨满',
        21030401: '岩丘丘萨满',
        21030402: '岩丘丘萨满',
        21030501: '冰丘丘萨满',
        21030601: '雷丘丘萨满',
        21030603: '雷丘丘萨满',
        24010101: '遗迹守卫',
        24010108: '遗迹守卫',
        24010109: '遗迹守卫',
        24010201: '遗迹猎者',
        24010301: '遗迹重机',
        24010303: '遗迹重机',
        24010401: '遗迹巨蛇',
        24020101: '遗迹巡弋者',
        24020102: '遗迹巡弋者',
        24020103: '遗迹巡弋者',
        24020201: '遗迹歼击者',
        24020202: '遗迹歼击者',
        24020203: '遗迹歼击者',
        24020301: '遗迹防卫者',
        24020302: '遗迹防卫者',
        24020303: '遗迹防卫者',
        24020401: '遗迹侦察者',
        24020402: '遗迹侦察者',
        24020403: '遗迹侦察者',
        24021101: '恒常机关阵列',
        24021102: '恒常机关阵列',
        23010101: '愚人众先遣队·冰铳重卫士',
        23010201: '愚人众先遣队·水铳重卫士',
        23010301: '愚人众先遣队·雷锤前锋军',
        23010401: '愚人众先遣队·岩使游击兵',
        23010501: '愚人众先遣队·风拳前锋军',
        23010601: '愚人众先遣队·火铳游击兵',
        23020101: '愚人众·火之债务处理人',
        23020102: '愚人众·火之债务处理人',
        23030101: '愚人众·雷萤术士',
        23030102: '愚人众·雷萤术士',
        23040101: '愚人众·冰萤术士',
        23040102: '愚人众·冰萤术士',
        23050101: '愚人众·藏镜仕女',
        25010101: '盗宝团·「溜溜」',
        25010102: '盗宝团·「溜溜」',
        25010103: '盗宝团·「溜溜」',
        25010104: '盗宝团·「溜溜」',
        25010105: '盗宝团·「溜溜」',
        25010106: '盗宝团·「溜溜」',
        25010201: '盗宝团·斥候',
        25010203: '盗宝团·斥候',
        25010204: '盗宝团·斥候',
        25010205: '盗宝团·斥候',
        25010206: '盗宝团·斥候',
        25010207: '盗宝团·斥候',
        25010208: '盗宝团·斥候',
        25010301: '盗宝团·火之药剂师',
        25010302: '盗宝团·火之药剂师',
        25010401: '盗宝团·水之药剂师',
        25010501: '盗宝团·雷之药剂师',
        25010601: '盗宝团·冰之药剂师',
        25010701: '盗宝团·杂工',
        25020101: '盗宝团·「怪鸟」',
        25020102: '盗宝团·「怪鸟」',
        25020201: '盗宝团·神射手',
        25020204: '盗宝团·神射手',
        25030101: '盗宝团·「卡门」',
        25030102: '盗宝团·「卡门」',
        25030103: '盗宝团·「卡门」',
        25030201: '盗宝团·掘墓者',
        25030301: '盗宝团·海上男儿',
        25040101: '盗宝团·「大姐头」',
        25040102: '盗宝团·「大姐头」',
        25040103: '盗宝团·「大姐头」',
        25050101: '千岩军士兵',
        25050201: '千岩军教头',
        25050301: '幕府足轻',
        25050401: '幕府足轻头',
        25050402: '幕府足轻头',
        25050501: '珊瑚宫众',
        25050502: '珊瑚宫众',
        25060101: '盗宝团·拳术家',
        25060102: '盗宝团·拳术家',
        25070101: '盗宝团·粉碎者',
        25070201: '盗宝团·「瓦伦斯坦」',
        25070202: '盗宝团·「瓦伦斯坦」',
        25080101: '野伏·阵刀番',
        25080201: '野伏·火付番',
        25080202: '野伏·火付番',
        25080301: '野伏·机巧番',
        25080401: '寄骑武士',
        25080402: '寄骑武士',
        25090101: '魔偶剑鬼',
        25090102: '魔偶剑鬼',
        25090103: '魔偶剑鬼',
        25090104: '魔偶剑鬼',
        25090201: '魔偶剑鬼·孤风',
        25090301: '魔偶剑鬼·霜驰',
        25090401: '魔偶剑鬼·凶面',
        25100101: '海乱鬼·雷腾',
        25100301: '落武者·咒雷',
        25100201: '海乱鬼·炎威',
        25100401: '落武者·祟炎',
        25100102: '海乱鬼·雷腾',
        25100302: '落武者·咒雷',
        26010101: '冰霜骗骗花',
        26010102: '冰霜骗骗花',
        26010103: '冰霜骗骗花',
        26010104: '冰霜骗骗花',
        26010201: '炽热骗骗花',
        26010301: '电气骗骗花',
        26020101: '急冻树',
        26020102: '急冻树',
        26020201: '爆炎树',
        26030101: '幼岩龙蜥',
        26040101: '岩龙蜥',
        26040102: '岩龙蜥',
        26040103: '岩龙蜥',
        26040104: '岩龙蜥',
        26050101: '古岩龙蜥',
        26050201: '古岩龙蜥',
        26050301: '古岩龙蜥',
        26050401: '古岩龙蜥',
        26050501: '古岩龙蜥',
        26050601: '深海龙蜥·原种',
        26050901: '深海龙蜥·原种',
        26050701: '深海龙蜥·啮冰',
        26051001: '深海龙蜥·啮冰',
        26050702: '深海龙蜥·啮冰',
        26050801: '深海龙蜥·吞雷',
        26051101: '深海龙蜥·吞雷',
        26050802: '深海龙蜥·吞雷',
        26060101: '雷萤',
        26060201: '水萤',
        26060301: '冰萤',
        26080101: '跋掣',
        26090101: '浮游水蕈兽',
        20060101: '水飘浮灵',
        20060201: '岩飘浮灵',
        20060301: '风飘浮灵',
        20060401: '冰飘浮灵',
        20060501: '雷飘浮灵',
        20060601: '火飘浮灵',
        21010102: '丘丘人',
        21020102: '木盾丘丘暴徒',
        21020203: '火斧丘丘暴徒',
        21020702: '雷斧丘丘暴徒',
        21020302: '岩盾丘丘暴徒',
        21020402: '丘丘霜铠王',
        21020502: '丘丘岩盔王',
        21020802: '丘丘雷兜王',
        21020602: '冰盾丘丘暴徒',
        20010302: '风史莱姆',
        20010402: '大型风史莱姆',
        20010502: '雷史莱姆',
        20010602: '大型雷史莱姆',
        20010703: '变异雷史莱姆',
        20010803: '冰史莱姆',
        20010903: '大型冰史莱姆',
        20011002: '水史莱姆',
        20011102: '大型水史莱姆',
        21010302: '木盾丘丘人',
        21010702: '冲锋丘丘人',
        21011202: '岩盾丘丘人',
        21011402: '冰盾丘丘人',
        20011203: '火史莱姆',
        20011302: '大型火史莱姆',
        20011402: '岩史莱姆',
        20011503: '大型岩史莱姆',
        22010105: '火深渊法师',
        22010205: '冰深渊法师',
        22010305: '水深渊法师',
        22010402: '雷深渊法师',
        21030102: '水丘丘萨满',
        21030202: '草丘丘萨满',
        21030302: '风丘丘萨满',
        21030403: '岩丘丘萨满',
        21030502: '冰丘丘萨满',
        21030602: '雷丘丘萨满',
        24010102: '遗迹守卫',
        24010202: '遗迹猎者',
        24010302: '遗迹重机',
        26040105: '岩龙蜥'
      },
      currentMonInfo: {},
      currentMonIndex: -1,
      currentItemInfo: {},
      currentItemIndex: -1
    }
  },
  mounted: function () {
    let self = this
    var itemdata = require('../../static/item.json')
    for (var row in itemdata) {
      self.$data.itemid2name[parseInt(row)] = itemdata[row]
    }
    var itemList = []
    for (var item in self.$data.itemid2name) {
      itemList.push(
        {
          key: item,
          value: self.$data.itemid2name[item]
        }
      )
    }
    self.$data.itemList = itemList
  },
  methods: {
    download () {
      var fileName = 'Drop.json'
      var content = JSON.stringify(this.$data.dropJson)
      var aTag = document.createElement('a')
      var blob = new Blob([content])
      aTag.download = fileName
      aTag.href = URL.createObjectURL(blob)
      aTag.click()
      URL.revokeObjectURL(blob)
      console.log('download file..')
    },
    upload (event) {
      let that = this
      console.log(event.target.files[0].name)
      const reader = new FileReader()
      reader.onload = function () {
        that.$data.dropJson = JSON.parse(this.result)
        console.log(that.$data.dropJson)
      }
      reader.readAsText(event.target.files[0])
    },
    handleEdit (index, row) {
      this.$data.currentMonIndex = index
      this.$data.currentMonInfo = row
      this.$data.dialogTableVisible = true
    },
    handleDelete (index, row) {
      this.$data.dropJson.splice(index, 1)
    },
    handleItemEdit (index, row) {
      this.$data.currentItemIndex = index
      this.$data.currentItemInfo = row
      this.$data.itemTableVisible = true
    },
    handleItemDelete (index, row) {
      if (this.$data.dialogTableVisible) this.$data.currentMonInfo.dropDataList.splice(index, 1)
    },
    handleAdd () {
      this.$data.dropJson = [{
        'monsterId': 21010101,
        'dropDataList': []
      }].concat(this.$data.dropJson)
    },
    handleItemAdd () {
      let self = this
      if (self.$data.dialogTableVisible) {
        self.$data.currentMonInfo.dropDataList = [{
          'itemId': 202,
          'minCount': 1,
          'maxCount': 10,
          'minWeight': 0,
          'maxWeight': 10000
        }].concat(self.$data.currentMonInfo.dropDataList)
      }
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.monDialog {
  width: none;
}
</style>
